<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium User Panel - Refer Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: white;
            background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            min-height: 100vh;
            padding-bottom: 100px;
            overflow-x: hidden;
        }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .page { display: none; animation: fadeIn 0.4s ease-in-out; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-active { color: #a78bfa !important; transform: scale(1.1); }
        
        #toast { visibility: hidden; min-width: 250px; background: #a78bfa; color: white; text-align: center; border-radius: 12px; padding: 15px; position: fixed; z-index: 2000; left: 50%; transform: translateX(-50%); bottom: 110px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #toast.show { visibility: visible; animation: slideUp 0.5s forwards; }
        @keyframes slideUp { from { bottom: 0; opacity: 0; } to { bottom: 110px; opacity: 1; } }

        #timer-modal, #notif-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1500;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .timer-box { background: #1e293b; border: 2px solid #a78bfa; border-radius: 24px; padding: 40px; text-align: center; width: 100%; max-width: 320px; }
        .count-circle { width: 80px; height: 80px; border: 4px solid #a78bfa; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; margin: 20px auto; color: #a78bfa; }
    </style>
</head>
<body class="antialiased">

    <div id="toast">Message here</div>

    <div id="timer-modal">
        <div class="timer-box shadow-2xl">
            <h3 class="text-xl font-bold">Ad is Playing...</h3>
            <div class="count-circle" id="countdown-display">30</div>
            <p class="text-gray-400 text-sm">Do not close. Balance will be added after 30 seconds.</p>
        </div>
    </div>

    <div id="notif-modal">
        <div class="glass p-8 rounded-3xl max-w-xs w-full text-center border border-white/10">
            <i class="fa-solid fa-bullhorn text-4xl text-yellow-400 mb-4"></i>
            <h3 class="text-xl font-bold mb-2">New Update!</h3>
            <p class="text-gray-400 text-sm mb-6">Refer your friends to earn ৳10 per person. Withdrawals are processed within 24 hours.</p>
            <button onclick="toggleModal('notif-modal')" class="w-full bg-purple-600 py-3 rounded-xl font-bold">Close</button>
        </div>
    </div>

    <header class="p-5 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-purple-500 to-pink-500 p-[2px]">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=User" class="w-full h-full rounded-full border-2 border-[#0f172a]">
            </div>
            <div>
                <p class="text-gray-400 text-[10px] tracking-widest uppercase">My Balance</p>
                <h2 class="text-xl font-bold">৳ <span id="header-balance">0.00</span></h2>
            </div>
        </div>
        <div onclick="toggleModal('notif-modal')" class="relative glass p-2.5 rounded-full cursor-pointer hover:bg-white/10 transition">
            <i class="fa-solid fa-bell text-gray-300"></i>
            <span class="absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
        </div>
    </header>

    <div id="home-page" class="page active-page px-5">
        <section class="mb-6">
            <div class="w-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-[2rem] p-7 shadow-2xl relative overflow-hidden">
                <p class="text-white/70 text-sm font-medium">Total Earnings</p>
                <h3 class="text-4xl font-bold mt-1">৳ <span id="main-balance">0.00</span></h3>
                <div class="flex gap-3 mt-8">
                    <button onclick="switchPage('wallet')" class="flex-1 bg-white text-purple-700 py-3.5 rounded-2xl font-bold text-sm shadow-lg active:scale-95 transition">Withdraw</button>
                    <button onclick="claimDailyBonus()" class="flex-1 glass text-white py-3.5 rounded-2xl font-bold text-sm border border-white/20 active:scale-95 transition">Daily Bonus</button>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="glass p-5 rounded-3xl text-center"><h3 class="text-2xl font-bold" id="task-count">0</h3><p class="text-[10px] text-gray-400 uppercase">Ads Watched</p></div>
            <div class="glass p-5 rounded-3xl text-center"><h3 class="text-2xl font-bold">৳10</h3><p class="text-[10px] text-gray-400 uppercase">Refer Earn</p></div>
        </div>
    </div>

    <div id="task-page" class="page px-5">
        <h3 class="text-xl font-bold mb-5 text-purple-400">Earning Tasks</h3>
        <div class="glass p-5 rounded-3xl mb-4 flex items-center justify-between border-l-4 border-red-500">
            <div class="flex items-center gap-4">
                <i class="fa-brands fa-youtube text-3xl text-red-500"></i>
                <div><h4 class="font-bold text-sm">Video Ad #1</h4><p class="text-xs text-green-400 font-bold">+৳3.50</p></div>
            </div>
            <button onclick="startAdTimer(3.50)" class="bg-blue-600 px-6 py-2.5 rounded-xl text-xs font-bold active:scale-90 transition">Watch</button>
        </div>
    </div>

    <div id="refer-page" class="page px-5">
        <h3 class="text-xl font-bold mb-5 text-purple-400">Refer & Earn</h3>
        <div class="glass p-8 rounded-[2rem] text-center border border-white/10">
            <div class="w-20 h-20 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-users text-3xl text-purple-400"></i>
            </div>
            <h4 class="text-lg font-bold mb-2">Invite Friends</h4>
            <p class="text-gray-400 text-xs mb-6 px-4">Share your link and earn ৳10 for every user who joins using your code.</p>
            <div class="bg-slate-800 p-4 rounded-2xl flex justify-between items-center border border-white/5 mb-4">
                <span class="text-sm font-bold text-purple-300">ADS78291</span>
                <button onclick="showToast('Code Copied!')" class="text-xs bg-purple-600 px-4 py-2 rounded-xl font-bold">Copy</button>
            </div>
            <button onclick="showToast('Referral link shared!')" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition">Share Now</button>
        </div>
    </div>

    <div id="wallet-page" class="page px-5">
        <h3 class="text-xl font-bold mb-5 text-purple-400">Withdraw Wallet</h3>
        <div class="glass p-6 rounded-[2rem]">
            <label class="text-xs text-gray-400 mb-2 block">Payment Method</label>
            <select id="pay-method" class="w-full bg-slate-800 border border-white/10 p-4 rounded-2xl mb-5 outline-none text-sm">
                <option>bKash</option><option>Nagad</option>
            </select>
            <label class="text-xs text-gray-400 mb-2 block">Phone Number</label>
            <input id="pay-number" type="number" placeholder="01XXXXXXXXX" class="w-full bg-slate-800 border border-white/10 p-4 rounded-2xl mb-5 outline-none text-sm">
            <label class="text-xs text-gray-400 mb-2 block">Amount</label>
            <input id="draw-amount" type="number" placeholder="Min ৳100" class="w-full bg-slate-800 border border-white/10 p-4 rounded-2xl mb-8 outline-none text-sm">
            <button onclick="handleWithdraw()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition">Submit Request</button>
        </div>
    </div>

    <div id="profile-page" class="page px-5 text-center">
        <div class="mt-6 flex flex-col items-center">
            <div class="w-24 h-24 rounded-full border-4 border-purple-500 p-1 mb-4 shadow-xl">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=User" class="w-full h-full rounded-full">
            </div>
            <h2 class="text-2xl font-bold">Rahim Ahmed</h2>
            <p class="text-gray-400 text-xs">User ID: #78291</p>
        </div>
        <div class="mt-10 space-y-3">
            <div class="glass p-5 rounded-2xl flex justify-between items-center text-sm"><span>Total Withdraw</span><span class="text-red-400 font-bold">৳0.00</span></div>
            <div class="glass p-5 rounded-2xl flex justify-between items-center text-sm"><span>Join Date</span><span>15 Jan 2026</span></div>
        </div>
    </div>

    <nav class="fixed bottom-4 left-4 right-4 h-20 glass rounded-[2.5rem] flex justify-around items-center z-[100] px-2 shadow-2xl">
        <button onclick="switchPage('home')" id="nav-home" class="flex flex-col items-center gap-1 nav-active text-gray-400 transition-all"><i class="fa-solid fa-house text-xl"></i><span class="text-[9px] font-bold">Home</span></button>
        <button onclick="switchPage('task')" id="nav-task" class="flex flex-col items-center gap-1 text-gray-400 transition-all"><i class="fa-solid fa-list-check text-xl"></i><span class="text-[9px] font-bold">Task</span></button>
        <button onclick="switchPage('refer')" id="nav-refer" class="relative -top-6 flex flex-col items-center gap-1 transition-all">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg border-[6px] border-[#0c1324] text-white">
                <i class="fa-solid fa-users text-2xl"></i>
            </div>
        </button>
        <button onclick="switchPage('wallet')" id="nav-wallet" class="flex flex-col items-center gap-1 text-gray-400 transition-all"><i class="fa-solid fa-wallet text-xl"></i><span class="text-[9px] font-bold">Wallet</span></button>
        <button onclick="switchPage('profile')" id="nav-profile" class="flex flex-col items-center gap-1 text-gray-400 transition-all"><i class="fa-solid fa-user text-xl"></i><span class="text-[9px] font-bold">Profile</span></button>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAVMOaK58kpTRrbUJvWzNa7A9v6Lum6Y18",
            authDomain: "adsearn-ab376.firebaseapp.com",
            projectId: "adsearn-ab376",
            databaseURL: "https://adsearn-ab376-default-rtdb.firebaseio.com",
            storageBucket: "adsearn-ab376.firebasestorage.app",
            messagingSenderId: "49081496929",
            appId: "1:49081496929:web:ff1522dc639cbe3a6b4120"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const userId = "78291"; 

        let userData = { balance: 0.00, adsCount: 0, lastBonus: "" };

        function loadData() {
            database.ref('users/' + userId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    userData = data;
                    updateUI();
                } else {
                    saveData();
                }
            });
        }

        function saveData() {
            database.ref('users/' + userId).set(userData);
        }

        function updateUI() {
            document.getElementById('main-balance').innerText = (userData.balance || 0).toFixed(2);
            document.getElementById('header-balance').innerText = (userData.balance || 0).toFixed(2);
            document.getElementById('task-count').innerText = userData.adsCount || 0;
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(pageId + '-page').classList.add('active-page');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('nav-' + pageId).classList.add('nav-active');
        }

        function startAdTimer(reward) {
            const modal = document.getElementById('timer-modal');
            const display = document.getElementById('countdown-display');
            let timeLeft = 30;
            modal.style.display = 'flex';
            display.innerText = timeLeft;

            const countdown = setInterval(() => {
                timeLeft--;
                display.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    modal.style.display = 'none';
                    userData.balance = (userData.balance || 0) + reward;
                    userData.adsCount = (userData.adsCount || 0) + 1;
                    saveData();
                    showToast(`৳${reward.toFixed(2)} Added!`);
                }
            }, 1000);
        }

        function handleWithdraw() {
            const amt = parseFloat(document.getElementById('draw-amount').value);
            const num = document.getElementById('pay-number').value;
            const method = document.getElementById('pay-method').value;

            if(amt > userData.balance || isNaN(amt) || amt < 100) {
                showToast("Insufficient Balance! Min ৳100");
            } else {
                userData.balance -= amt;
                saveData();
                database.ref('withdrawals').push({
                    userId: userId,
                    amount: amt,
                    phone: num,
                    method: method,
                    status: "Pending",
                    timestamp: Date.now()
                });
                showToast("Withdraw Request Sent!");
            }
        }

        function claimDailyBonus() {
            const today = new Date().toDateString();
            if(userData.lastBonus === today) {
                showToast("Come back tomorrow!");
            } else {
                userData.balance = (userData.balance || 0) + 10;
                userData.lastBonus = today;
                saveData();
                showToast("Daily Bonus ৳10 Added!");
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.innerText = msg;
            t.className = "show";
            setTimeout(() => { t.className = ""; }, 3000);
        }

        loadData();
    </script>
</body>
</html>